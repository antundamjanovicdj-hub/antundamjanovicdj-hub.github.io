<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>LifeKompas</title>

  <!-- âœ… ISPRAVLJEN LINK ZA CAVEAT FONT -->
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&display=swap" rel="stylesheet">

  <link rel="manifest" href="manifest-v2.json?v=2" />
  <link rel="icon" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="LifeKompas">
  <meta name="theme-color" content="#0d5e32">

  <link rel="stylesheet" href="styles/main.css">
</head>

<body>

<div class="app">

  <!-- LANGUAGE SCREEN â€” ZAKRIVLJENI CAVEAT NASLOVI -->
  <div id="screen-lang" class="screen active">
    <div class="lang-circle-container">
      <!-- ===== ZAKRIVLJENI TEKST S HTML + CSS ===== -->
      <div class="lang-title-top">LIFE</div>
      <div class="lang-title-bottom">KOMPAS</div>

      <!-- SAMO JEDAN .lang-circle -->
      <div class="lang-circle">
        <button class="lang-btn" data-lang="hr">ğŸ‡­ğŸ‡·</button>
        <button class="lang-btn" data-lang="en">ğŸ‡ºğŸ‡¸</button>
        <button class="lang-btn" data-lang="de">ğŸ‡©ğŸ‡ª</button>
        <button class="lang-btn" data-lang="ru">ğŸ‡·ğŸ‡º</button>
        <button class="lang-btn" data-lang="pt">ğŸ‡µğŸ‡¹</button>
        <button class="lang-btn" data-lang="tr">ğŸ‡¹ğŸ‡·</button>
        <button class="lang-btn" data-lang="zh">ğŸ‡¨ğŸ‡³</button>
        <button class="lang-btn" data-lang="ja">ğŸ‡¯ğŸ‡µ</button>
      </div>
    </div>
  </div>

  <!-- MENU -->
<div id="screen-menu" class="screen">
  <button class="back" id="backMenu">â†</button>
  <div class="main-menu-buttons">
    <button class="menu-item" id="btnObligations">ğŸ§­ Obveze</button>
    <button class="menu-item" id="btnContacts">ğŸ‘¥ Kontakti</button>
    <button class="menu-item" id="btnFinances">ğŸ’° Financije</button>
    <button class="menu-item" id="btnDiary">ğŸ““ Dnevnik</button>
  </div>
</div>

  <!-- TASKS -->
  <div id="screen-tasks" class="screen">
    <button class="back" id="backTasks">â†</button>
    <div class="content scroll">
      <label id="tTitleL"></label>
      <input id="taskTitle">
      <label id="tNoteL"></label>
      <textarea id="taskNote"></textarea>
      <label id="tCatL"></label>
      <select id="taskCategory"></select>
      <label id="tDateL"></label>
      <input type="date" id="taskDate">
      <label id="tTimeL"></label>
      <input type="time" id="taskTime">
      <label id="tRemL"></label>
      <select id="taskReminder">
        <option value="0">â€”</option>
        <option value="30">30 min</option>
        <option value="60">1 h</option>
        <option value="120">2 h</option>
        <option value="1440">1 dan</option>
      </select>

      <div id="reminderHint" class="reminder-hint hidden"></div>

      <div class="calendar-box">
        <label class="calendar-label">
          <input type="checkbox" id="addToCalendar" checked>
          <span id="calendarLabel"></span>
        </label>
      </div>

      <button class="btn" id="saveTask"></button>
      <button class="btn" id="btnByDay"></button>

      <div id="taskList"></div>
      <div id="calendarInfo" class="note"></div>
    </div>
  </div>

</div> <!-- .app -->

<!-- POPUP -->
<div id="dayPopup" class="popup">
  <div class="popup-box">
    <div class="popup-header">
      <strong id="popupTitle"></strong>
      <button id="closeDayPopup">âœ•</button>
    </div>
    <label id="popupDateLabel"></label>
    <input type="date" id="popupDate">
    <div id="popupTasks"></div>
  </div>
</div>

<!-- BALONIÄ† POPUP ZA OBVEZE -->
<div id="obligationsPopup" class="popup-balloon">
  <div class="balloon-content">
    <button class="balloon-btn" id="btnAddObligation">â• Nova obveza</button>
    <button class="balloon-btn" id="btnEditObligation">âœï¸ Uredi obvezu</button>
    <button class="balloon-btn" id="btnViewByDay">ğŸ“… Pregled po danima</button>
  </div>
</div>

<!-- SKRIPTOVE U REDOSLIJEDU -->
<script src="core/i18n.js"></script>
<script src="core/ui.js"></script>
<script src="modules/tasks/tasks.state.js"></script>
<script src="modules/tasks/tasks.ui.js"></script>
<script src="modules/tasks/tasks.popup.js"></script>
<script src="modules/tasks/tasks.calendar.js"></script>
<script src="modules/tasks/tasks.controller.js"></script>
<script src="core/app.js"></script>

<!-- Service Worker -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/service-worker.js').catch(console.warn);
    });
  }
</script>

<!-- Language Switcher -->
<script>
  window.languageSelected = false;

  function setLanguage(lang) {
    localStorage.setItem('userLang', lang);
    document.documentElement.setAttribute('lang', lang);
    window.languageSelected = true;

    // âœ… PRIKAÅ½I IZBORNIK I POKRENI ANIMACIJU
    const menuScreen = document.getElementById('screen-menu');

    // 1. Sakrij gumbove (reset prije nove animacije)
    menuScreen.querySelectorAll('.menu-item').forEach(item => {
      item.classList.remove('animate');
      void item.offsetWidth; // force reflow
    });

    // 2. AÅ¾uriraj tekstove
    document.getElementById('btnObligations').textContent = I18N[lang].menu.obligations;
    document.getElementById('btnContacts').textContent = I18N[lang].menu.contacts;
    document.getElementById('btnFinances').textContent = I18N[lang].menu.finances;
    document.getElementById('btnDiary').textContent = I18N[lang].menu.diary;

    // 3. Sakrij izbornik jezika, prikaÅ¾i glavni izbornik
    document.getElementById('screen-lang').classList.remove('active');
    menuScreen.classList.add('active');

    // 4. Pokreni animaciju NAKON kratkog delaya
    setTimeout(() => {
      const items = menuScreen.querySelectorAll('.menu-item');
      items.forEach((item, i) => {
        setTimeout(() => {
          item.classList.add('animate');
        }, 200 * i); // 0ms, 200ms, 400ms, 600ms
      });
    }, 50);
  }

  document.addEventListener('DOMContentLoaded', function() {
    var buttons = document.querySelectorAll('.lang-btn');
    for (var i = 0; i < buttons.length; i++) {
      buttons[i].addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        var lang = this.getAttribute('data-lang');
        setLanguage(lang);
      });
    }
  });
</script>

<!-- BALONIÄ† LOGIKA -->
<script>
// AÅ½URIRAJ TEKST BALONIÄ†A NA TEMELJU IZABRANOG JEZIKA
function updateObligationsPopupText() {
  const lang = localStorage.getItem('userLang') || 'hr';
  document.getElementById('btnAddObligation').textContent = I18N[lang].menu.addObligation;
  document.getElementById('btnEditObligation').textContent = I18N[lang].menu.editObligation;
  document.getElementById('btnViewByDay').textContent = I18N[lang].menu.viewByDay;
}

// OTVARANJE BALONIÄ†A ZA OBVEZE â€” S ANIMACIJOM
document.getElementById('btnObligations').addEventListener('click', function(e) {
  e.stopPropagation();
  updateObligationsPopupText();

  const popup = document.getElementById('obligationsPopup');
  if (popup.style.display === 'block') {
    popup.style.display = 'none';
    popup.classList.remove('animate');
  } else {
    popup.style.display = 'block';
    // malo delaya da se DOM osvjeÅ¾i
    setTimeout(() => {
      popup.classList.add('animate');
    }, 10);
  }
});

// ZATVARANJE BALONIÄ†A KADA SE KLIKNNE IZVAN NJEGA
document.addEventListener('click', function(e) {
  const popup = document.getElementById('obligationsPopup');
  const btn = document.getElementById('btnObligations');
  if (popup.style.display === 'block' && !popup.contains(e.target) && e.target !== btn) {
    popup.style.display = 'none';
    popup.classList.remove('animate');
  }
});
</script>

</body>
</html>